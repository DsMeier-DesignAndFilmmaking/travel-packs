<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Blocking script first: manifest + title + canonical before any other head content or body. No static <link rel="manifest"> anywhere. -->
  <script>
    (function() {
      var pathname = window.location.pathname || '/';
      var cityMatch = /^\/city\/([^/]+)$/.exec(pathname);
      if (!cityMatch) return;
      var slug = cityMatch[1];
      var titleFromSlug = slug.replace(/-/g, ' ').replace(/\b\w/g, function(c) { return c.toUpperCase(); });
      var cityTitle = titleFromSlug + ' Travel Pack';
      var canonicalHref = window.location.href;
      document.title = cityTitle;
      var meta = document.createElement('meta');
      meta.name = 'apple-mobile-web-app-title';
      meta.content = cityTitle;
      document.head.appendChild(meta);
      var canonical = document.createElement('link');
      canonical.rel = 'canonical';
      canonical.href = canonicalHref;
      document.head.appendChild(canonical);
      var origin = window.location.origin;
      var startUrl = window.location.href;
      var manifest = {
        id: pathname,
        name: cityTitle,
        short_name: cityTitle,
        description: 'Offline-first travel guide for ' + titleFromSlug,
        start_url: startUrl,
        scope: origin + '/',
        display: 'standalone',
        background_color: '#ffffff',
        theme_color: '#0f172a',
        icons: [
          { src: origin + '/pwa-192x192.png', sizes: '192x192', type: 'image/png', purpose: 'any maskable' },
          { src: origin + '/pwa-512x512.png', sizes: '512x512', type: 'image/png', purpose: 'any maskable' }
        ]
      };
      var json = JSON.stringify(manifest);
      var base64 = btoa(unescape(encodeURIComponent(json)));
      var dataUri = 'data:application/manifest+json;base64,' + base64;
      var link = document.createElement('link');
      link.rel = 'manifest';
      link.href = dataUri;
      document.head.appendChild(link);
    })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f172a">
  <link rel="icon" type="image/png" href="/pwa-192x192.png">
  <link rel="apple-touch-icon" href="/pwa-192x192.png">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Local City Travel Packs</title>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
  <script>
    (function() {
      function log(label) {
        var link = document.querySelector('link[rel="manifest"]');
        console.log('[A2HS ' + label + '] manifest:', link ? link.href.substring(0, 60) + '...' : 'none', '| title:', document.title);
      }
      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', function() { log('DOMContentLoaded'); });
      else log('DOMContentLoaded(sync)');
      window.addEventListener('load', function() { log('load'); });
    })();
  </script>
</body>
</html>
